<div id="posts-tab" class="container tab-pane fade" role="tabpanel">
    <br>
    <h2>Posts</h2>
    <p>Here you will be able to see your posts</p>
    <hr style="border: 1px solid black">

    <div class="col-12 text-center mb-4">
        <select id="sortDropdownPost" onchange="sortPosts()">
            <option value="">Sort By</option>
            <option value="priceAsc">Price: Lowest to Highest</option>
            <option value="priceDesc">Price: Highest to Lowest</option>
            <option value="alphaAsc">Alphabetical: A to Z</option>
            <option value="alphaDesc">Alphabetical: Z to A</option>
        </select>
    </div>

    <div class="d-flex flex-wrap justify-content-center" id="postContainer">
        <% if (locals.posts && locals.posts.length> 0) { %>
            <% posts.forEach(function(post, index) { %>
                <div class="post-container my-3 mx-3" style="max-width: 20rem" data-price="<%= post.itemPrice %>" data-name="<%= post.itemName %>">
                    <div class="card shadow h-100">
                        <% if (post.itemThumbnail !== null) { %>
                            <img src="<%= post.itemThumbnail %>" data-post-thumbnail="<%= post.itemThumbnail %>" class="card-img-top img-fluid" style="height: 50%" alt="Image of <%= post.itemName %>">
                        <% } else { %>
                            <img src="<%= post.itemPicture %>" data-post-image="<%= post.itemPicture %>" class="card-img-top img-fluid" style="height:50%; object-fit: cover;" alt="Image of <%= post.itemName %>">
                        <% } %>
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title text-center mb-3"><%= post.itemName %></h5>
                            <p class="card-text mb-3 text-center"><%= post.itemDescription %></p>
                            <% if (post.course) { %>
                                <p class="card-text mb-3 text-center"><strong>Course:</strong> <%= post.course %></p>
                            <% } %>
                            <p class="card-text mb-0 text-center"><strong>$<%= post.itemPrice %></strong></p>
                            <div class="d-flex justify-content-center mt-3">
                                <button type="button" class="btn btn-danger me-2 delete-button" data-bs-toggle="modal" data-target="#deleteModal" data-post-id="<%= post.postId %>">Delete</button>
                                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-target="#editModal" data-post-id="<%= post.postId %>">Edit</button>
                            </div>
                        </div>
                    </div>
                </div>
                <% }) %>
                    <% } else { %>
                        <div class="m-auto my-3">
                            <h3 class="display-4">You have no Posts</h3>
                        </div>
                        <% } %>
    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.delete-button').forEach(button => {
        button.addEventListener('click', async (event) => {
            const postId = event.target.getAttribute('data-post-id');
            const thumbnailPath = event.target.getAttribute('data-post-thumbnail');
            const imagePath = event.target.getAttribute('data-post-image');
            // Confirm deletion with the user 
            if (confirm('Are you sure you want to delete this post?')) {
                try {
                    const response = await fetch(`/delete-post/${postId}`, {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json',
                        }
                    });

                    if (response.ok) {
                        alert('Post deleted successfully');
                        // Remove the post from the DOM if the deletion is successful
                        event.target.closest('.post-container').remove();
                    } else {
                        alert('Failed to delete the post');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('An error occurred while deleting the post');
                }
            }
        });
    });
});
</script>
<script>
    function sortPosts() {
        const dropdown = document.getElementById('sortDropdownPost');
        const itemsContainer = document.getElementById('postContainer');
        const items = Array.from(itemsContainer.getElementsByClassName('post-container'));

        const sortBy = dropdown.value;

        items.sort((a, b) => {
             const priceA = parseFloat(a.getAttribute('data-price'));
            const priceB = parseFloat(b.getAttribute('data-price'));
            const nameA = a.getAttribute('data-name').toLowerCase();
            const nameB = b.getAttribute('data-name').toLowerCase();

            switch (sortBy) {
                case 'priceAsc':
                    return priceA - priceB;
                case 'priceDesc':
                    return priceB - priceA;
                case 'alphaAsc':
                    return nameA.localeCompare(nameB);
                case 'alphaDesc':
                    return nameB.localeCompare(nameA);
                default:
                    return 0;
            }
        });

        itemsContainer.innerHTML = '';
        items.forEach(item => itemsContainer.appendChild(item));
    }
</script>